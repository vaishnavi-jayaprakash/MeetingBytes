(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))a(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&a(s)}).observe(document,{childList:!0,subtree:!0});function m(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(t){if(t.ep)return;t.ep=!0;const o=m(t);fetch(t.href,o)}})();document.addEventListener("DOMContentLoaded",()=>{const c=document.getElementById("root");if(!c)return;c.innerHTML=`
    <h1>MeetingBytes</h1>
    <button id="mb-start" class="start">üéôÔ∏è Start Recording</button>
    <button id="mb-stop" class="stop" style="display:none;">‚èπ Stop Recording</button>
    <div id="mb-summary" class="summary-box" style="display:none;">
      <h2>Summary:</h2>
      <p id="mb-summary-text"></p>
      <a id="mb-summary-pdf" href="#" download="meeting_summary.pdf" style="display:none;">Download PDF</a>
    </div>
    <div style="margin-top:8px;"><a id="mb-open-tab" href="chrome-extension://${chrome.runtime.id}/popup.html" target="_blank">Open in tab</a></div>
  `;const i=document.getElementById("mb-start"),m=document.getElementById("mb-stop"),a=document.getElementById("mb-summary"),t=document.getElementById("mb-summary-text"),o=document.getElementById("mb-summary-pdf");function s(e){i.style.display=e?"none":"inline-block",m.style.display=e?"inline-block":"none"}chrome.storage.session.get(["mb_isRecording"],e=>{e&&e.mb_isRecording&&s(!0)}),location.protocol==="chrome-extension:"&&window.top===window&&(t.textContent="Start must be clicked from the toolbar popup on the page you want to record (not this extension tab).",a.style.display="block"),i.addEventListener("click",()=>{try{window.mb_stream&&typeof window.mb_stream.getTracks=="function"&&(window.mb_stream.getTracks().forEach(e=>e.stop()),window.mb_stream=null),chrome.tabCapture.capture({audio:!0,video:!1},e=>{if(chrome.runtime.lastError){t.textContent=`Error: ${chrome.runtime.lastError.message}`,a.style.display="block";return}if(!e){t.textContent="Error: No audio stream. Open a normal tab with audio.",a.style.display="block";return}try{window.mb_mediaRecorder=new MediaRecorder(e,{mimeType:"audio/webm"})}catch(r){t.textContent=`Error: ${r&&r.message?r.message:String(r)}`,a.style.display="block";return}window.mb_stream=e,window.mb_audioChunks=[],window.mb_mediaRecorder.ondataavailable=r=>{r.data&&r.data.size>0&&window.mb_audioChunks.push(r.data)},window.mb_mediaRecorder.start(1e3),chrome.storage.session.set({mb_isRecording:!0}),s(!0)})}catch(e){t.textContent=`Error: ${e&&e.message?e.message:String(e)}`,a.style.display="block"}}),m.addEventListener("click",()=>{const e=window.mb_mediaRecorder;if(!e||e.state==="inactive"){s(!1);return}e.onstop=async()=>{try{if(typeof e.requestData=="function")try{e.requestData()}catch{}await new Promise(n=>setTimeout(n,150))}catch{}const r=new Blob(window.mb_audioChunks||[],{type:"audio/webm"});try{const n=new FormData;n.append("file",r,"meeting_audio.webm");const d=await(await fetch("http://localhost:8000/transcribe",{method:"POST",body:n})).json();d.summary&&(t.textContent=d.summary),d.pdf_base64&&(o.href=`data:application/pdf;base64,${d.pdf_base64}`,o.style.display="inline-block"),d.warning&&console.warn("Backend warning:",d.warning)}catch(n){t.textContent=`Error: ${n&&n.message?n.message:String(n)}`}finally{a.style.display="block"}},e.stop(),window.mb_stream&&typeof window.mb_stream.getTracks=="function"&&(window.mb_stream.getTracks().forEach(r=>r.stop()),window.mb_stream=null),chrome.storage.session.set({mb_isRecording:!1}),s(!1)}),chrome.runtime.onMessage.addListener(e=>{e.type==="SUMMARY_READY"&&(e.summary?t.textContent=e.summary:e.error?t.textContent=`Error: ${e.error}`:t.textContent="No summary available",a.style.display="block",e.pdf_base64&&(o.href=`data:application/pdf;base64,${e.pdf_base64}`,o.style.display="inline-block"))})});
